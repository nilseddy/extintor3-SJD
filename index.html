<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extintor EXT001 - CM SJD</title>
    
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 3px solid #2c3e50;
            padding-bottom: 20px;
        }
        
        .main-title {
            font-size: 26px;
            font-weight: bold;
            color: #2c3e50;
            margin: 0;
            text-transform: uppercase;
        }
        
        .sub-title {
            font-size: 18px;
            font-weight: bold;
            color: #3498db;
            margin: 8px 0 0 0;
        }
        
        .extintor-numero {
            font-size: 48px;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            margin: 20px 0;
            background: linear-gradient(135deg, #3498db, #2c3e50);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .nav-extintor {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background-color: #3498db;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            min-width: 150px;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .nav-btn.warning {
            background-color: #f39c12;
        }
        
        .nav-btn.warning:hover {
            background-color: #d68910;
        }
        
        .nav-btn.success {
            background-color: #2ecc71;
        }
        
        .nav-btn.success:hover {
            background-color: #27ae60;
        }
        
        /* TARJETAS DE DATOS */
        .data-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .data-card h3 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .data-item {
            background: white;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
        }
        
        .data-label {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .data-value {
            color: #34495e;
            font-size: 16px;
        }
        
        /* FORMULARIO DE EDICI√ìN */
        .edit-form {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #3498db;
            margin-top: 20px;
            display: none;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-secondary {
            background-color: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #7f8c8d;
        }
        
        /* CHECKBOXES DE PAR√ÅMETROS */
        .parametros-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .parametro-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
        }
        
        .parametro-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .parametro-item label {
            flex: 1;
            cursor: pointer;
            font-size: 14px;
        }
        
        .parametro-number {
            background: #3498db;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            flex-shrink: 0;
        }
        
        /* ESTADO */
        .status-container {
            text-align: center;
            margin: 30px 0;
        }
        
        .status-badge {
            display: inline-block;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .status-ok {
            background-color: #d4edda;
            color: #155724;
            border: 3px solid #28a745;
        }
        
        .status-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 3px solid #ffc107;
        }
        
        .status-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 3px solid #dc3545;
        }
        
        /* TABLA DE INSPECCI√ìN */
        .inspection-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .inspection-table th {
            background: #2c3e50;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }
        
        .inspection-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .inspection-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .check-status {
            display: inline-block;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            font-weight: bold;
        }
        
        .check-yes {
            background-color: #2ecc71;
            color: white;
        }
        
        .check-no {
            background-color: #e74c3c;
            color: white;
        }
        
        /* IMAGEN */
        .image-container {
            text-align: center;
            margin: 30px 0;
        }
        
        .extintor-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 10px;
            border: 3px solid #3498db;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .no-image {
            padding: 40px;
            background: #f8f9fa;
            border: 3px dashed #ddd;
            border-radius: 10px;
            color: #666;
            font-style: italic;
        }
        
        .upload-image-container {
            text-align: center;
            margin-top: 20px;
        }
        
        .upload-btn {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .upload-btn:hover {
            background-color: #2980b9;
        }
        
        .hidden-file-input {
            display: none;
        }
        
        /* NOTIFICACIONES */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        .notification.success {
            background: #2ecc71;
        }
        
        .notification.error {
            background: #e74c3c;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* RESPONSIVO */
        @media (max-width: 768px) {
            .extintor-numero {
                font-size: 36px;
            }
            
            .nav-extintor {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-btn {
                width: 100%;
                max-width: 300px;
            }
            
            .data-grid {
                grid-template-columns: 1fr;
            }
            
            .parametros-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            
            .nav-extintor {
                display: none !important;
            }
            
            .data-card {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
                page-break-inside: avoid;
            }
            
            .edit-form, .upload-image-container {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ENCABEZADO -->
        <div class="header">
            <h1 class="main-title">REGISTRO DE INSPECCI√ìN DE EXTINTORES</h1>
            <h2 class="sub-title">CM SAN JUAN DE DIOS - SJD</h2>
            <div class="extintor-numero">EXT001</div>
        </div>
        
        <!-- NAVEGACI√ìN -->
        <div class="nav-extintor no-print">
            <a href="index.html" class="nav-btn">üè† INICIO</a>
            <button id="btnEditar" class="nav-btn warning">‚úèÔ∏è EDITAR</button>
            <button class="nav-btn" onclick="window.print()">üñ®Ô∏è IMPRIMIR</button>
            <a href="#" class="nav-btn success" onclick="verTodos()">üìã VER TODOS</a>
            <!-- Botones de navegaci√≥n entre extintores -->
            <button onclick="irExtintor(35)" class="nav-btn" style="background-color: #9b59b6;">‚¨ÖÔ∏è ANTERIOR</button>
            <button onclick="irExtintor(2)" class="nav-btn" style="background-color: #9b59b6;">‚û°Ô∏è SIGUIENTE</button>
        </div>
        
        <!-- ESTADO ACTUAL -->
        <div class="status-container">
            <div id="statusBadge" class="status-badge status-ok">
                ‚úÖ EN ORDEN - APROBADO
            </div>
            <p id="statusDescription">Todos los par√°metros de inspecci√≥n est√°n correctos.</p>
        </div>
        
        <!-- DATOS B√ÅSICOS (VISTA) -->
        <div class="data-card">
            <h3>üìã DATOS GENERALES</h3>
            <div class="data-grid">
                <div class="data-item">
                    <div class="data-label">N√∫mero de Extintor</div>
                    <div class="data-value" id="numeroExtintor">EXT001</div>
                </div>
                <div class="data-item">
                    <div class="data-label">ID √önico</div>
                    <div class="data-value" id="idExtintor">EXT001</div>
                </div>
                <div class="data-item">
                    <div class="data-label">Ubicaci√≥n Exacta</div>
                    <div class="data-value" id="ubicacionExtintor">Pasillo Principal - Planta Baja</div>
                </div>
                <div class="data-item">
                    <div class="data-label">√Årea / Departamento</div>
                    <div class="data-value" id="areaExtintor">Administraci√≥n</div>
                </div>
                <div class="data-item">
                    <div class="data-label">Tipo de Extintor</div>
                    <div class="data-value" id="tipoExtintor">CO2</div>
                </div>
                <div class="data-item">
                    <div class="data-label">Capacidad / Peso</div>
                    <div class="data-value" id="capacidadExtintor">5 kg</div>
                </div>
            </div>
        </div>
        
        <!-- FORMULARIO DE EDICI√ìN (OCULTO INICIALMENTE) -->
        <div id="editForm" class="edit-form">
            <h3>‚úèÔ∏è EDITAR DATOS DEL EXTINTOR EXT001</h3>
            
            <div class="form-group">
                <label for="editNumero">N√∫mero de Extintor *</label>
                <input type="text" id="editNumero" value="EXT001" required>
            </div>
            
            <div class="form-group">
                <label for="editUbicacion">Ubicaci√≥n Exacta *</label>
                <input type="text" id="editUbicacion" value="Pasillo Principal - Planta Baja" required>
            </div>
            
            <div class="form-group">
                <label for="editArea">√Årea / Departamento *</label>
                <input type="text" id="editArea" value="Administraci√≥n" required>
            </div>
            
            <div class="form-group">
                <label for="editId">ID √önico *</label>
                <input type="text" id="editId" value="EXT001" required>
            </div>
            
            <div class="form-group">
                <label for="editTipo">Tipo de Extintor *</label>
                <select id="editTipo">
                    <option value="PQS" selected>PQS</option>
                    <option value="K">TIPO K</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="editCapacidad">Capacidad / Peso</label>
                <input type="text" id="editCapacidad" value="5 kg">
            </div>
            
            <!-- DATOS DE INSPECCI√ìN -->
            <h4 style="margin-top: 25px; color: #2c3e50;">üìÖ INSPECCI√ìN MENSUAL</h4>
            
            <div class="form-group">
                <label for="editFechaInspeccion">Fecha de Inspecci√≥n *</label>
                <input type="date" id="editFechaInspeccion" value="2024-01-27">
            </div>
            
            <div class="form-group">
                <label for="editInspector">Inspector *</label>
                <input type="text" id="editInspector" value="Inspector del Sistema" required>
            </div>
            
            <div class="form-group">
                <label for="editCargoInspector">Cargo del Inspector *</label>
                <input type="text" id="editCargoInspector" value="Personal Autorizado" required>
            </div>
            
            <!-- CHECKBOXES DE INSPECCI√ìN B√ÅSICA -->
            <h4>Estado de Inspecci√≥n B√°sica</h4>
            <div class="parametros-grid">
                <div class="parametro-item">
                    <input type="checkbox" id="checkBasico1">
                    <label for="checkBasico1">Tiene precinto y pasador</label>
                </div>
                <div class="parametro-item">
                    <input type="checkbox" id="checkBasico2">
                    <label for="checkBasico2">Buena condici√≥n del cilindro</label>
                </div>
                <div class="parametro-item">
                    <input type="checkbox" id="checkBasico3">
                    <label for="checkBasico3">Manguera ajustada</label>
                </div>
                <div class="parametro-item">
                    <input type="checkbox" id="checkBasico4">
                    <label for="checkBasico4">Tobera y cintur√≥n ajustado</label>
                </div>
                <div class="parametro-item">
                    <input type="checkbox" id="checkBasico5">
                    <label for="checkBasico5">Se√±alizaci√≥n visible</label>
                </div>
                <div class="parametro-item">
                    <input type="checkbox" id="checkBasico6">
                    <label for="checkBasico6">Instrucciones legibles</label>
                </div>
                <div class="parametro-item">
                    <input type="checkbox" id="checkBasico7">
                    <label for="checkBasico7">Presi√≥n adecuada</label>
                </div>
                <div class="parametro-item">
                    <input type="checkbox" id="checkBasico8">
                    <label for="checkBasico8">Sin desgaste, √≥xido o fugas</label>
                </div>
                <div class="parametro-item">
                    <input type="checkbox" id="checkBasico9">
                    <label for="checkBasico9">Limpieza sin polvo o residuos</label>
                </div>
            </div>
            
            <!-- PAR√ÅMETROS DETALLADOS -->
            <h4 style="margin-top: 30px; color: #2c3e50;">üìä PAR√ÅMETROS DE INSPECCI√ìN DETALLADOS</h4>
            
            <div class="parametros-grid" id="parametrosDetallados">
                <!-- Los par√°metros se generar√°n din√°micamente -->
            </div>
            
            <!-- OBSERVACIONES -->
            <div class="form-group">
                <label for="editObservaciones">Observaciones</label>
                <textarea id="editObservaciones" rows="4" placeholder="Agregue observaciones adicionales..."></textarea>
            </div>
            
            <div class="form-actions">
                <button id="btnCancelar" class="btn btn-secondary">Cancelar</button>
                <button id="btnGuardar" class="btn btn-primary">üíæ GUARDAR CAMBIOS</button>
            </div>
        </div>
        
        <!-- INSPECCI√ìN ACTUAL (VISTA) -->
        <div class="data-card">
            <h3>‚úÖ ESTADO DE INSPECCI√ìN</h3>
            <table class="inspection-table">
                <tr>
                    <th>Par√°metro de Inspecci√≥n</th>
                    <th>Estado</th>
                </tr>
                <tr>
                    <td>Tiene precinto y pasador</td>
                    <td><span id="checkPrecinto" class="check-status check-yes">‚úì</span></td>
                </tr>
                <tr>
                    <td>Buena condici√≥n del cilindro</td>
                    <td><span id="checkCondicion" class="check-status check-yes">‚úì</span></td>
                </tr>
                <tr>
                    <td>Manguera ajustada</td>
                    <td><span id="checkManguera" class="check-status check-yes">‚úì</span></td>
                </tr>
                <tr>
                    <td>Tobera y cintur√≥n ajustado</td>
                    <td><span id="checkTobera" class="check-status check-yes">‚úì</span></td>
                </tr>
                <tr>
                    <td>Se√±alizaci√≥n visible</td>
                    <td><span id="checkSenalizacion" class="check-status check-yes">‚úì</span></td>
                </tr>
                <tr>
                    <td>Instrucciones legibles</td>
                    <td><span id="checkInstrucciones" class="check-status check-yes">‚úì</span></td>
                </tr>
                <tr>
                    <td>Presi√≥n adecuada</td>
                    <td><span id="checkPresion" class="check-status check-yes">‚úì</span></td>
                </tr>
                <tr>
                    <td>Sin desgaste, √≥xido o fugas</td>
                    <td><span id="checkDesgaste" class="check-status check-yes">‚úì</span></td>
                </tr>
                <tr>
                    <td>Limpieza sin polvo o residuos</td>
                    <td><span id="checkLimpieza" class="check-status check-yes">‚úì</span></td>
                </tr>
            </table>
        </div>
        
        <!-- PAR√ÅMETROS DETALLADOS (VISTA) -->
        <div class="data-card" id="parametrosDetalladosView">
            <h3>üìä PAR√ÅMETROS DETALLADOS DE INSPECCI√ìN</h3>
            <div id="parametrosList">
                <!-- Los par√°metros se generar√°n din√°micamente -->
            </div>
        </div>
        
        <!-- HISTORIAL -->
        <div class="data-card">
            <h3>üìÖ HISTORIAL DE MANTENIMIENTO</h3>
            <div class="data-grid">
                <div class="data-item">
                    <div class="data-label">√öltima Inspecci√≥n</div>
                    <div class="data-value" id="ultimaInspeccion">27/01/2024</div>
                </div>
                <div class="data-item">
                    <div class="data-label">Inspector</div>
                    <div class="data-value" id="inspector">Inspector del Sistema</div>
                </div>
                <div class="data-item">
                    <div class="data-label">Cargo</div>
                    <div class="data-value" id="cargoInspector">Personal Autorizado</div>
                </div>
                <div class="data-item">
                    <div class="data-label">Fecha de Recarga</div>
                    <div class="data-value" id="fechaRecarga">15/01/2023</div>
                </div>
                <div class="data-item">
                    <div class="data-label">Pr√≥xima Recarga</div>
                    <div class="data-value" id="proximaRecarga" style="color: #e74c3c; font-weight: bold;">15/01/2025</div>
                </div>
            </div>
        </div>
        
        <!-- IMAGEN -->
        <div class="data-card">
            <h3>üì∑ IMAGEN DEL EXTINTOR</h3>
            <div class="image-container">
                <div id="imagePlaceholder" class="no-image">
                    <p style="font-size: 48px;">üì∏</p>
                    <p>No hay imagen cargada para este extintor</p>
                    <button id="btnCargarImagen" class="upload-btn">
                        üìÅ Cargar imagen
                    </button>
                    <input type="file" id="fileInput" class="hidden-file-input" accept="image/*">
                </div>
                <div id="imagePreviewContainer" style="display: none;">
                    <img id="imagePreview" src="" alt="Extintor EXT001" class="extintor-image">
                    <div style="margin-top: 15px;">
                        <button id="btnCambiarImagen" class="upload-btn" style="background-color: #f39c12;">
                            üîÑ Cambiar imagen
                        </button>
                        <button id="btnEliminarImagen" class="upload-btn" style="background-color: #e74c3c; margin-left: 10px;">
                            üóëÔ∏è Eliminar
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- OBSERVACIONES (VISTA) -->
        <div class="data-card" id="observacionesView" style="display: none;">
            <h3>üìù OBSERVACIONES</h3>
            <div id="observacionesContent" style="padding: 15px; background: white; border-radius: 5px; border: 1px solid #e0e0e0; font-size: 14px;">
                <!-- Las observaciones se cargar√°n aqu√≠ -->
            </div>
        </div>
    </div>
    
    <!-- SCRIPT PRINCIPAL MODIFICADO PARA EXT001 -->
    <script>
        // ==============================================
        // CONFIGURACI√ìN ESPEC√çFICA PARA EXT001
        // ==============================================
        const NUMERO_EXTINTOR = "001";
        const ID_EXTINTOR = "EXT001";
        
        // Funci√≥n para navegar entre extintores
        function irExtintor(num) {
            if (num < 1) num = 35;
            if (num > 35) num = 1;
            const numStr = num.toString().padStart(3, '0');
            window.location.href = `extintor-${numStr}.html`;
        }
        
        // ==============================================
        // LISTA DE PAR√ÅMETROS
        // ==============================================
        const parametrosInspeccion = [
            "Mal ubicado",
            "Acceso obstruido",
            "Zona y/o extintor no enumerado",
            "Pictograma de clase de fuego Carece/Ilegible",
            "Pictograma de forma de uso: Carece/Ilegible",
            "Etiqueta de recarga: Carece/Ilegible",
            "Tipo de cargaje/ Carga",
            "Colgador-Ausente/Inadecuado",
            "Sin pasador y/o precinto de seguridad",
            "Man√≥metro: Con presi√≥n inadecuada/ da√±ado",
            "Manija de acarreo/Palanca de activaci√≥n de cabezal/pistola da√±ada ausente",
            "Manguera: Da√±ada/Ausente",
            "Tobera, pi√±√≥n o pistola: da√±ada/Ausente",
            "Abrazadera o sujetador de manguera: Inadecuado/Da√±ado/Ausente",
            "Cilindro/Botella/Cartucho impulsor en mal estado",
            "Pintura deteriorada en: Cilindro/Botella/Cartucho impulsor",
            "Otros"
        ];

        // ==============================================
        // VARIABLES GLOBALES
        // ==============================================
        let extintorData = null;
        let isEditing = false;

        // ==============================================
        // FUNCIONES DE INICIALIZACI√ìN
        // ==============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Generar par√°metros detallados
            generarParametrosDetallados();
            
            // Cargar datos
            cargarDatosExtintor();
            
            // Configurar event listeners
            configurarEventListeners();
        });

        function generarParametrosDetallados() {
            const containerEdit = document.getElementById('parametrosDetallados');
            const containerView = document.getElementById('parametrosList');
            
            containerEdit.innerHTML = '';
            containerView.innerHTML = '';
            
            parametrosInspeccion.forEach((parametro, index) => {
                const numero = index + 1;
                
                // Para edici√≥n
                const itemEdit = document.createElement('div');
                itemEdit.className = 'parametro-item';
                itemEdit.innerHTML = `
                    <div class="parametro-number">${numero}</div>
                    <input type="checkbox" id="param${numero}">
                    <label for="param${numero}">${parametro}</label>
                `;
                containerEdit.appendChild(itemEdit);
                
                // Para vista
                const itemView = document.createElement('div');
                itemView.className = 'parametro-item';
                itemView.id = `paramView${numero}`;
                itemView.innerHTML = `
                    <div class="parametro-number">${numero}</div>
                    <label>${parametro}</label>
                    <span id="paramStatus${numero}" class="check-status check-no" style="margin-left: auto;">‚úó</span>
                `;
                containerView.appendChild(itemView);
            });
        }

        function configurarEventListeners() {
            // Botones de navegaci√≥n
            document.getElementById('btnEditar').addEventListener('click', toggleEdicion);
            document.getElementById('btnCancelar').addEventListener('click', cancelarEdicion);
            document.getElementById('btnGuardar').addEventListener('click', guardarDatos);
            
            // Botones de imagen
            document.getElementById('btnCargarImagen').addEventListener('click', () => {
                document.getElementById('fileInput').click();
            });
            
            document.getElementById('btnCambiarImagen').addEventListener('click', () => {
                document.getElementById('fileInput').click();
            });
            
            document.getElementById('btnEliminarImagen').addEventListener('click', eliminarImagen);
            
            document.getElementById('fileInput').addEventListener('change', manejarCargaImagen);
        }

        // ==============================================
        // FUNCIONES DE CARGA DE DATOS
        // ==============================================
        function cargarDatosExtintor() {
            try {
                // Intentar cargar desde localStorage del sistema principal
                const inventario = JSON.parse(localStorage.getItem('extintorInventory') || '[]');
                
                // Buscar este extintor espec√≠fico
                extintorData = inventario.find(ext => 
                    ext.extintorId === ID_EXTINTOR || 
                    ext.numero === ID_EXTINTOR
                );
                
                if (extintorData) {
                    console.log(`‚úÖ Extintor ${ID_EXTINTOR} encontrado en inventario`);
                    cargarDatosEnVista(extintorData);
                } else {
                    console.log(`‚ö†Ô∏è Extintor ${ID_EXTINTOR} no encontrado, usando datos por defecto`);
                    crearDatosPorDefecto();
                }
            } catch (error) {
                console.error(`‚ùå Error cargando datos del extintor ${ID_EXTINTOR}:`, error);
                crearDatosPorDefecto();
            }
        }

        function crearDatosPorDefecto() {
            extintorData = {
                id: ID_EXTINTOR,
                numero: ID_EXTINTOR,
                extintorId: ID_EXTINTOR,
                ubicacion: 'Pasillo Principal - Planta Baja',
                area: 'Administraci√≥n',
                tipo: 'CO2',
                capacidad: '5 kg',
                fechaInspeccion: new Date().toISOString().split('T')[0],
                inspector: 'Inspector del Sistema',
                cargoInspector: 'Personal Autorizado',
                ultimaInspeccion: formatFecha(new Date()),
                fechaRecarga: formatFecha(new Date(new Date().getFullYear() - 1, 0, 15)),
                proximaRecarga: formatFecha(new Date(new Date().getFullYear() + 1, 0, 15)),
                observaciones: `Extintor ${ID_EXTINTOR} - Administraci√≥n`,
                
                // Inspecci√≥n b√°sica
                precinto: true,
                condicion: true,
                manguera: true,
                tobera: true,
                senalizacion: true,
                instrucciones: true,
                presion: true,
                desgaste: true,
                limpieza: true,
                
                // Par√°metros detallados
                parametrosDetallados: Array(17).fill(false),
                
                // Imagen
                imagen: '',
                
                // Fechas
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            cargarDatosEnVista(extintorData);
        }

        function cargarDatosEnVista(datos) {
            // Datos b√°sicos
            document.getElementById('numeroExtintor').textContent = datos.numero || ID_EXTINTOR;
            document.getElementById('idExtintor').textContent = datos.extintorId || ID_EXTINTOR;
            document.getElementById('ubicacionExtintor').textContent = datos.ubicacion || 'No especificada';
            document.getElementById('areaExtintor').textContent = datos.area || 'No especificada';
            document.getElementById('tipoExtintor').textContent = datos.tipo || 'No especificado';
            document.getElementById('capacidadExtintor').textContent = datos.capacidad || 'No especificado';
            
            // Historial
            document.getElementById('ultimaInspeccion').textContent = datos.ultimaInspeccion || 'No registrada';
            document.getElementById('inspector').textContent = datos.inspector || 'No especificado';
            document.getElementById('cargoInspector').textContent = datos.cargoInspector || 'No especificado';
            document.getElementById('fechaRecarga').textContent = datos.fechaRecarga || 'No registrada';
            document.getElementById('proximaRecarga').textContent = datos.proximaRecarga || 'No programada';
            
            // Inspecci√≥n b√°sica
            actualizarCheck('checkPrecinto', datos.precinto);
            actualizarCheck('checkCondicion', datos.condicion);
            actualizarCheck('checkManguera', datos.manguera);
            actualizarCheck('checkTobera', datos.tobera);
            actualizarCheck('checkSenalizacion', datos.senalizacion);
            actualizarCheck('checkInstrucciones', datos.instrucciones);
            actualizarCheck('checkPresion', datos.presion);
            actualizarCheck('checkDesgaste', datos.desgaste);
            actualizarCheck('checkLimpieza', datos.limpieza);
            
            // Par√°metros detallados
            if (datos.parametrosDetallados) {
                datos.parametrosDetallados.forEach((valor, index) => {
                    const elemento = document.getElementById(`paramStatus${index + 1}`);
                    if (elemento) {
                        elemento.textContent = valor ? '‚úì' : '‚úó';
                        elemento.className = valor ? 'check-status check-yes' : 'check-status check-no';
                    }
                });
            }
            
            // Imagen
            if (datos.imagen) {
                document.getElementById('imagePreview').src = datos.imagen;
                document.getElementById('imagePreviewContainer').style.display = 'block';
                document.getElementById('imagePlaceholder').style.display = 'none';
            }
            
            // Observaciones
            if (datos.observaciones) {
                document.getElementById('observacionesContent').textContent = datos.observaciones;
                document.getElementById('observacionesView').style.display = 'block';
            }
            
            // Actualizar estado general
            actualizarEstadoGeneral(datos);
        }

        function cargarDatosEnFormulario(datos) {
            // Datos b√°sicos
            document.getElementById('editNumero').value = datos.numero || ID_EXTINTOR;
            document.getElementById('editUbicacion').value = datos.ubicacion || '';
            document.getElementById('editArea').value = datos.area || '';
            document.getElementById('editId').value = datos.extintorId || ID_EXTINTOR;
            document.getElementById('editTipo').value = datos.tipo || 'CO2';
            document.getElementById('editCapacidad').value = datos.capacidad || '';
            
            // Inspecci√≥n
            document.getElementById('editFechaInspeccion').value = datos.fechaInspeccion || new Date().toISOString().split('T')[0];
            document.getElementById('editInspector').value = datos.inspector || '';
            document.getElementById('editCargoInspector').value = datos.cargoInspector || '';
            
            // Inspecci√≥n b√°sica
            document.getElementById('checkBasico1').checked = datos.precinto || false;
            document.getElementById('checkBasico2').checked = datos.condicion || false;
            document.getElementById('checkBasico3').checked = datos.manguera || false;
            document.getElementById('checkBasico4').checked = datos.tobera || false;
            document.getElementById('checkBasico5').checked = datos.senalizacion || false;
            document.getElementById('checkBasico6').checked = datos.instrucciones || false;
            document.getElementById('checkBasico7').checked = datos.presion || false;
            document.getElementById('checkBasico8').checked = datos.desgaste || false;
            document.getElementById('checkBasico9').checked = datos.limpieza || false;
            
            // Par√°metros detallados
            if (datos.parametrosDetallados) {
                datos.parametrosDetallados.forEach((valor, index) => {
                    const checkbox = document.getElementById(`param${index + 1}`);
                    if (checkbox) {
                        checkbox.checked = valor;
                    }
                });
            }
            
            // Observaciones
            document.getElementById('editObservaciones').value = datos.observaciones || '';
        }

        // ==============================================
        // FUNCIONES DE EDICI√ìN
        // ==============================================
        function toggleEdicion() {
            isEditing = !isEditing;
            
            if (isEditing) {
                document.getElementById('editForm').style.display = 'block';
                document.getElementById('btnEditar').textContent = '‚ùå CANCELAR';
                document.getElementById('btnEditar').classList.add('danger');
                cargarDatosEnFormulario(extintorData);
                scrollToElement('editForm');
            } else {
                cancelarEdicion();
            }
        }

        function cancelarEdicion() {
            isEditing = false;
            document.getElementById('editForm').style.display = 'none';
            document.getElementById('btnEditar').textContent = '‚úèÔ∏è EDITAR';
            document.getElementById('btnEditar').classList.remove('danger');
        }

        function scrollToElement(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // ==============================================
        // FUNCI√ìN PARA GUARDAR DATOS EN EL INVENTARIO
        // ==============================================
        function guardarDatos() {
            // Validar campos obligatorios
            if (!validarFormulario()) {
                mostrarNotificacion('Complete los campos obligatorios (*)', 'error');
                return;
            }
            
            // Recoger datos del formulario
            const nuevosDatos = {
                id: ID_EXTINTOR,
                numero: document.getElementById('editNumero').value.trim() || ID_EXTINTOR,
                extintorId: document.getElementById('editId').value.trim() || ID_EXTINTOR,
                ubicacion: document.getElementById('editUbicacion').value.trim(),
                area: document.getElementById('editArea').value.trim(),
                tipo: document.getElementById('editTipo').value,
                capacidad: document.getElementById('editCapacidad').value.trim(),
                fechaInspeccion: document.getElementById('editFechaInspeccion').value,
                inspector: document.getElementById('editInspector').value.trim(),
                cargoInspector: document.getElementById('editCargoInspector').value.trim(),
                ultimaInspeccion: formatFecha(new Date(document.getElementById('editFechaInspeccion').value)),
                fechaRecarga: extintorData.fechaRecarga || '',
                proximaRecarga: extintorData.proximaRecarga || '',
                observaciones: document.getElementById('editObservaciones').value.trim(),
                
                // Inspecci√≥n b√°sica
                precinto: document.getElementById('checkBasico1').checked,
                condicion: document.getElementById('checkBasico2').checked,
                manguera: document.getElementById('checkBasico3').checked,
                tobera: document.getElementById('checkBasico4').checked,
                senalizacion: document.getElementById('checkBasico5').checked,
                instrucciones: document.getElementById('checkBasico6').checked,
                presion: document.getElementById('checkBasico7').checked,
                desgaste: document.getElementById('checkBasico8').checked,
                limpieza: document.getElementById('checkBasico9').checked,
                
                // Par√°metros detallados
                parametrosDetallados: [],
                
                // Imagen
                imagen: extintorData.imagen || '',
                
                // Fechas
                createdAt: extintorData.createdAt || new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // Recoger par√°metros detallados
            for (let i = 1; i <= parametrosInspeccion.length; i++) {
                const checkbox = document.getElementById(`param${i}`);
                nuevosDatos.parametrosDetallados.push(checkbox ? checkbox.checked : false);
            }
            
            // Actualizar datos locales
            extintorData = { ...extintorData, ...nuevosDatos };
            
            // Guardar en el inventario del sistema principal
            const guardadoExitoso = guardarEnInventario(extintorData);
            
            // Actualizar vista
            cargarDatosEnVista(extintorData);
            
            // Cerrar edici√≥n
            cancelarEdicion();
            
            // Mostrar confirmaci√≥n
            if (guardadoExitoso) {
                mostrarNotificacion(`‚úÖ Datos del ${ID_EXTINTOR} guardados correctamente`, 'success');
            } else {
                mostrarNotificacion('‚ö†Ô∏è Error al guardar en el inventario', 'error');
            }
        }

        function validarFormulario() {
            const campos = ['editNumero', 'editUbicacion', 'editArea', 'editId', 
                          'editInspector', 'editCargoInspector', 'editFechaInspeccion'];
            
            for (const campo of campos) {
                const elemento = document.getElementById(campo);
                if (!elemento.value.trim()) {
                    elemento.style.borderColor = '#e74c3c';
                    elemento.focus();
                    return false;
                } else {
                    elemento.style.borderColor = '#ddd';
                }
            }
            return true;
        }

        // ==============================================
        // FUNCI√ìN PARA GUARDAR EN EL INVENTARIO DEL SISTEMA PRINCIPAL
        // ==============================================
        function guardarEnInventario(datosExtintor) {
            try {
                // Cargar inventario existente
                let inventario = [];
                const inventarioGuardado = localStorage.getItem('extintorInventory');
                
                if (inventarioGuardado) {
                    inventario = JSON.parse(inventarioGuardado);
                }
                
                // Preparar datos para el inventario (formato del index.html)
                const datosInventario = {
                    id: datosExtintor.id || ID_EXTINTOR,
                    numero: datosExtintor.numero || ID_EXTINTOR,
                    extintorId: datosExtintor.extintorId || ID_EXTINTOR,
                    ubicacion: datosExtintor.ubicacion || '',
                    area: datosExtintor.area || '',
                    tipo: datosExtintor.tipo || '',
                    peso: datosExtintor.capacidad || '',
                    fecha: datosExtintor.fechaInspeccion || '',
                    inspector: datosExtintor.inspector || '',
                    cargo: datosExtintor.cargoInspector || '',
                    fechaRecarga: datosExtintor.fechaRecarga || '',
                    proximaRecarga: datosExtintor.proximaRecarga || '',
                    // Estados de inspecci√≥n b√°sica
                    precinto: datosExtintor.precinto || false,
                    condicion: datosExtintor.condicion || false,
                    manguera: datosExtintor.manguera || false,
                    tobera: datosExtintor.tobera || false,
                    senalizacion: datosExtintor.senalizacion || false,
                    instrucciones: datosExtintor.instrucciones || false,
                    presion: datosExtintor.presion || false,
                    desgaste: datosExtintor.desgaste || false,
                    limpieza: datosExtintor.limpieza || false,
                    // Matriz de agentes (convertir par√°metros detallados)
                    agentsMatrix: convertirParametrosAMatriz(datosExtintor.parametrosDetallados),
                    // Imagen
                    imagen: datosExtintor.imagen || '',
                    // Fechas
                    createdAt: datosExtintor.createdAt || new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                // Buscar si ya existe
                const indice = inventario.findIndex(ext => 
                    ext.id === datosInventario.id || 
                    ext.extintorId === datosInventario.extintorId
                );
                
                if (indice !== -1) {
                    // Actualizar extintor existente
                    inventario[indice] = { ...inventario[indice], ...datosInventario };
                } else {
                    // Agregar nuevo extintor
                    inventario.push(datosInventario);
                }
                
                // Guardar en localStorage
                localStorage.setItem('extintorInventory', JSON.stringify(inventario));
                
                console.log(`‚úÖ ${ID_EXTINTOR} guardado en inventario principal`);
                return true;
                
            } catch (error) {
                console.error('‚ùå Error guardando en el inventario:', error);
                return false;
            }
        }

        // Funci√≥n para convertir par√°metros detallados a matriz de agentes
        function convertirParametrosAMatriz(parametrosDetallados) {
            // Crear matriz 17x12 (par√°metros x meses)
            const matriz = Array(17).fill().map(() => Array(12).fill(false));
            
            if (parametrosDetallados && Array.isArray(parametrosDetallados)) {
                // Solo marcar el mes actual para cada par√°metro con problema
                const mesActual = new Date().getMonth(); // 0-11
                
                parametrosDetallados.forEach((tieneProblema, indexParam) => {
                    if (tieneProblema && indexParam < 17) {
                        matriz[indexParam][mesActual] = true;
                    }
                });
            }
            
            return matriz;
        }

        // ==============================================
        // FUNCIONES DE IMAGEN
        // ==============================================
        function manejarCargaImagen(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                mostrarNotificacion('Por favor, seleccione un archivo de imagen', 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                mostrarNotificacion('La imagen es demasiado grande (m√°ximo 5MB)', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                // Guardar imagen en datos
                extintorData.imagen = e.target.result;
                
                // Actualizar vista
                document.getElementById('imagePreview').src = e.target.result;
                document.getElementById('imagePreviewContainer').style.display = 'block';
                document.getElementById('imagePlaceholder').style.display = 'none';
                
                // Guardar autom√°ticamente en inventario
                guardarEnInventario(extintorData);
                
                mostrarNotificacion('‚úÖ Imagen cargada correctamente', 'success');
            };
            
            reader.readAsDataURL(file);
        }

        function eliminarImagen() {
            if (confirm('¬øEst√° seguro de eliminar la imagen?')) {
                extintorData.imagen = '';
                document.getElementById('imagePreviewContainer').style.display = 'none';
                document.getElementById('imagePlaceholder').style.display = 'block';
                document.getElementById('fileInput').value = '';
                
                // Guardar autom√°ticamente en inventario
                guardarEnInventario(extintorData);
                
                mostrarNotificacion('‚úÖ Imagen eliminada', 'success');
            }
        }

        // ==============================================
        // FUNCIONES DE UTILIDAD
        // ==============================================
        function actualizarCheck(elementId, valor) {
            const elemento = document.getElementById(elementId);
            if (elemento) {
                elemento.textContent = valor ? '‚úì' : '‚úó';
                elemento.className = valor ? 'check-status check-yes' : 'check-status check-no';
            }
        }

        function actualizarEstadoGeneral(datos) {
            const estadoElement = document.getElementById('statusBadge');
            const descripcionElement = document.getElementById('statusDescription');
            
            if (!datos.fechaInspeccion) {
                estadoElement.textContent = 'üì≠ SIN INSPECCI√ìN';
                estadoElement.className = 'status-badge status-warning';
                descripcionElement.textContent = 'Este extintor no ha sido inspeccionado todav√≠a.';
                return;
            }
            
            // Verificar si hay par√°metros detallados con problemas
            let problemasDetectados = 0;
            if (datos.parametrosDetallados) {
                problemasDetectados = datos.parametrosDetallados.filter(v => v === true).length;
            }
            
            // Verificar inspecci√≥n b√°sica
            const todosBasicosAprobados = datos.precinto && datos.condicion && datos.manguera && 
                                       datos.tobera && datos.senalizacion && datos.instrucciones && 
                                       datos.presion && datos.desgaste && datos.limpieza;
            
            if (problemasDetectados > 0) {
                estadoElement.textContent = '‚ö†Ô∏è REQUIERE ATENCI√ìN';
                estadoElement.className = 'status-badge status-warning';
                descripcionElement.textContent = `Se detectaron ${problemasDetectados} problemas en los par√°metros detallados.`;
            } else if (todosBasicosAprobados) {
                estadoElement.textContent = '‚úÖ EN ORDEN - APROBADO';
                estadoElement.className = 'status-badge status-ok';
                descripcionElement.textContent = 'Todos los par√°metros de inspecci√≥n est√°n correctos.';
            } else {
                estadoElement.textContent = '‚ö†Ô∏è REVISAR PAR√ÅMETROS B√ÅSICOS';
                estadoElement.className = 'status-badge status-warning';
                descripcionElement.textContent = 'Algunos par√°metros b√°sicos necesitan revisi√≥n.';
            }
        }

        function formatFecha(fechaString) {
            if (!fechaString) return '';
            try {
                const fecha = new Date(fechaString);
                return fecha.toLocaleDateString('es-ES');
            } catch (e) {
                return fechaString;
            }
        }

        function mostrarNotificacion(mensaje, tipo) {
            // Crear elemento de notificaci√≥n
            const notificacion = document.createElement('div');
            notificacion.className = `notification ${tipo}`;
            notificacion.textContent = mensaje;
            
            // Agregar al body
            document.body.appendChild(notificacion);
            
            // Remover despu√©s de 3 segundos
            setTimeout(() => {
                if (notificacion.parentElement) {
                    notificacion.remove();
                }
            }, 3000);
        }

        function verTodos() {
            window.location.href = 'index.html';
        }
        
        // ==============================================
        // FUNCI√ìN PARA EXPORTAR DATOS AL INDEX.HTML
        // ==============================================
        function notificarActualizacionIndex() {
            // Esta funci√≥n puede ser llamada para notificar a index.html
            // que se han actualizado los datos
            try {
                // Enviar un mensaje a la ventana principal (si index.html est√° abierto)
                if (window.opener) {
                    window.opener.postMessage({
                        type: 'extintorActualizado',
                        extintorId: ID_EXTINTOR,
                        timestamp: new Date().toISOString()
                    }, '*');
                }
                
                // Tambi√©n podemos almacenar un flag en localStorage
                localStorage.setItem('ultimaActualizacion', new Date().toISOString());
                localStorage.setItem('ultimoExtintorActualizado', ID_EXTINTOR);
                
            } catch (error) {
                console.log('Index.html no est√° abierto o no se puede notificar');
            }
        }
        
        // Llamar a esta funci√≥n despu√©s de guardar
        // Agrega esto al final de la funci√≥n guardarDatos():
        // notificarActualizacionIndex();
    </script>
</body>
</html>